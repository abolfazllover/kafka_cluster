# راه‌انداز کلاستر Kafka (Ubuntu / KRaft)

این پروژه یک اسکریپت تعاملی برای راه‌اندازی کلاستر **Apache Kafka در حالت KRaft (بدون ZooKeeper)** روی اوبونتو/دبیان است.

## پیش‌نیازها

- اوبونتو/دبیان
- دسترسی `sudo`
- دسترسی اینترنت برای دانلود Kafka از Apache

## اجرا

1) فایل را اجرایی کنید:

```bash
chmod +x ./kafka-cluster.sh
```

2) اجرا با روت:

```bash
sudo ./kafka-cluster.sh
```

## منو

- **نصب/آماده‌سازی**: Java 17 + ابزارها + دانلود Kafka + ساخت سرویس systemd
- **Primary**: ساخت `Cluster ID` و راه‌اندازی اولین نود
- **Secondary**: راه‌اندازی نودهای بعدی با `Cluster ID`
- **وضعیت**: وضعیت سرویس، پورت‌ها، و در صورت امکان وضعیت quorum
- **عیب‌یابی**: لاگ‌ها، دیسک، رم، زمان سیستم، UFW، خلاصه تنظیمات

## حداقل ورودی‌های لازم برای کلاستر

برای کلاستر واقعی (چندنودی) باید این موارد را بدانید:

- **node.id** یکتا برای هر نود
- **controller.quorum.voters** یک رشته مشترک بین همه نودها مثل:
  - `1@10.0.0.1:9093,2@10.0.0.2:9093,3@10.0.0.3:9093`
- **bind_ip** (بهتر است IP خصوصی همان سرور باشد)
- **advertised_host** (نام DNS یا IP که سایر نودها/کلاینت‌ها واقعاً به آن دسترسی دارند)

> توصیه: برای quorum حداقل **۳ نود** داشته باشید.

## امنیت

اسکریپت چند کار امنیتی پایه انجام می‌دهد:

- اجرای Kafka با کاربر محدود `kafka`
- سخت‌گیری systemd (ProtectSystem, NoNewPrivileges, …)
- فعال‌سازی Authorizer و جلوگیری از «همه‌چیز آزاد» (`allow.everyone.if.no.acl.found=false`)
- (اختیاری) افزودن قوانین UFW برای محدود کردن دسترسی به subnet مشخص

### نکته مهم درباره TLS

این اسکریپت به صورت پیش‌فرض **TLS/SSL** تولید نمی‌کند (چون گواهی معتبر معمولاً نیازمند CA/PKI سازمانی است).
اگر امنیت شبکه/اینترنت برایتان حیاتی است، توصیه می‌شود:

- Kafka را پشت شبکه خصوصی/VPN قرار دهید
- یا TLS را با گواهی معتبر و تنظیمات کامل فعال کنید

## فایل‌ها/مسیرهای مهم

- تنظیمات Kafka: `/etc/kafka/server.properties`
- cluster id: `/etc/kafka/cluster.id`
- دیتا: `/var/lib/kafka`
- لاگ سرویس: `journalctl -u kafka`
- سرویس: `systemctl status kafka`

## ریست نود (خطرناک)

در منو گزینه **ریست نود** دیتا و تنظیمات نود را پاک می‌کند. برای وقتی مناسب است که می‌خواهید از صفر join کنید.


